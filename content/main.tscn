[gd_scene load_steps=26 format=3 uid="uid://7cw2k7tpryji"]

[ext_resource type="Script" path="res://content/game/game.gd" id="1_q6t38"]
[ext_resource type="PackedScene" uid="uid://dpkbomvltkwjd" path="res://player/player.tscn" id="1_v2y50"]
[ext_resource type="Texture2D" uid="uid://c7lg1tgf5uy5j" path="res://icon.svg" id="2_clbah"]
[ext_resource type="PackedScene" uid="uid://b7ifegmm708j0" path="res://content/entities/spells/fire/fire_spell.tscn" id="3_6pgig"]
[ext_resource type="PackedScene" uid="uid://b4a43y8y3pfei" path="res://content/entities/crate/crate.tscn" id="4_qeshn"]
[ext_resource type="PackedScene" uid="uid://bdwlpvhvpqmqf" path="res://vfx/blood_effect/blood_effect.tscn" id="5_8p0uu"]
[ext_resource type="Shader" path="res://vfx/common_shaders/sprite_flash.gdshader" id="6_8bo0n"]
[ext_resource type="Shader" path="res://vfx/blood_effect/blood_container.gdshader" id="7_o2qfo"]
[ext_resource type="Script" path="res://components/spawner.gd" id="7_ofaj6"]
[ext_resource type="PackedScene" uid="uid://btv6lbk0s7oeo" path="res://content/entities/spells/fire/fire_spell_enemy.tscn" id="8_xv0h7"]

[sub_resource type="Environment" id="Environment_srm4m"]
background_mode = 3
glow_enabled = true
glow_levels/4 = 0.5
glow_levels/5 = 0.0
glow_normalized = true
glow_strength = 1.15
glow_blend_mode = 0

[sub_resource type="TileSetAtlasSource" id="TileSetAtlasSource_xl5km"]
texture = ExtResource("2_clbah")
1:1/0 = 0
1:1/0/z_index = -1
1:1/0/physics_layer_0/linear_velocity = Vector2(0, 0)
1:1/0/physics_layer_0/angular_velocity = 0.0
3:2/0 = 0
3:2/0/physics_layer_0/linear_velocity = Vector2(0, 0)
3:2/0/physics_layer_0/angular_velocity = 0.0
3:2/0/physics_layer_0/polygon_0/points = PackedVector2Array(-8, -8, 8, -8, 8, 8, -8, 8)

[sub_resource type="TileSet" id="TileSet_w3q41"]
physics_layer_0/collision_layer = 1
sources/0 = SubResource("TileSetAtlasSource_xl5km")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ocv7n"]
resource_local_to_scene = true
shader = ExtResource("6_8bo0n")
shader_parameter/flash = 0.0
shader_parameter/flash_color = Color(1, 1, 1, 1)

[sub_resource type="Gradient" id="Gradient_vv1b2"]
colors = PackedColorArray(1, 1, 1, 1, 1, 1, 1, 0)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_qnxt6"]
gradient = SubResource("Gradient_vv1b2")
fill = 1
fill_from = Vector2(0.512821, 0.5)
fill_to = Vector2(0.910256, 0.470085)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_06tm4"]
shader = ExtResource("7_o2qfo")
shader_parameter/min_a = 0.5
shader_parameter/spec_intensity = Color(1000, 1000, 1000, 1000)

[sub_resource type="ViewportTexture" id="ViewportTexture_2v0d8"]
viewport_path = NodePath("Sprite2D/BloodViewport")

[sub_resource type="Gradient" id="Gradient_5p7cw"]
interpolation_mode = 1
offsets = PackedFloat32Array(0, 0.667513)
colors = PackedColorArray(0.380392, 0.14902, 0.219608, 1, 0.44, 0.2024, 0.20636, 1)

[sub_resource type="GradientTexture1D" id="GradientTexture1D_8sfy7"]
gradient = SubResource("Gradient_5p7cw")
width = 32

[sub_resource type="Curve" id="Curve_2bkij"]
_data = [Vector2(0, 0), 0.0, 0.0, 0, 0, Vector2(1, 1), 1.31559, 0.0, 0, 0]
point_count = 2

[sub_resource type="CurveXYZTexture" id="CurveXYZTexture_8vc4f"]
curve_y = SubResource("Curve_2bkij")

[sub_resource type="Curve" id="Curve_melm4"]
max_value = 2.0
_data = [Vector2(0, 0), 0.0, 10.1621, 0, 0, Vector2(0.310427, 0.807104), -2.02398, -2.02398, 0, 0, Vector2(0.703791, 0.620504), 1.23336, 1.23336, 0, 0, Vector2(0.990521, 1.64928), -0.800021, 0.0, 0, 0]
point_count = 4

[sub_resource type="CurveTexture" id="CurveTexture_mtubc"]
curve = SubResource("Curve_melm4")

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_t0pgi"]
resource_local_to_scene = true
particle_flag_align_y = true
particle_flag_disable_z = true
spread = 48.2
initial_velocity_max = 35.0
directional_velocity_min = 1.0
directional_velocity_max = 13.8
directional_velocity_curve = SubResource("CurveXYZTexture_8vc4f")
gravity = Vector3(0, 0, 0)
scale_min = 0.2
scale_max = 0.4
scale_curve = SubResource("CurveTexture_mtubc")
color_initial_ramp = SubResource("GradientTexture1D_8sfy7")
anim_offset_max = 1.0

[node name="Main" type="Node2D" node_paths=PackedStringArray("blood_viewport")]
y_sort_enabled = true
script = ExtResource("1_q6t38")
blood_viewport = NodePath("Sprite2D/BloodViewport")

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_srm4m")

[node name="Player" parent="." instance=ExtResource("1_v2y50")]
position = Vector2(143, 80)

[node name="Camera2D" type="Camera2D" parent="Player"]
position_smoothing_enabled = true
position_smoothing_speed = 3.0

[node name="TileMap" type="TileMap" parent="."]
tile_set = SubResource("TileSet_w3q41")
format = 2
layer_0/tile_data = PackedInt32Array(131074, 196608, 2, 196610, 196608, 2, 262146, 196608, 2, 327682, 196608, 2, 65539, 196608, 2, 131075, 196608, 2, 196611, 65536, 1, 262147, 65536, 1, 4, 196608, 2, 65540, 196608, 2, 131076, 65536, 1, 196612, 65536, 1, 262148, 65536, 1, 5, 196608, 2, 65541, 65536, 1, 131077, 65536, 1, 196613, 65536, 1, 6, 196608, 2, 65542, 65536, 1, 131078, 65536, 1, 393218, 196608, 2, 458754, 196608, 2, 327683, 65536, 1, 393219, 65536, 1, 458755, 196608, 2, 327684, 65536, 1, 393220, 65536, 1, 458756, 196608, 2, 262149, 65536, 1, 327685, 65536, 1, 393221, 65536, 1, 458757, 196608, 2, 524293, 196608, 2, 196614, 65536, 1, 262150, 65536, 1, 327686, 65536, 1, 393222, 65536, 1, 458758, 65536, 1, 524294, 196608, 2, 7, 196608, 2, 65543, 65536, 1, 131079, 65536, 1, 196615, 65536, 1, 262151, 65536, 1, 327687, 65536, 1, 393223, 65536, 1, 458759, 65536, 1, 524295, 196608, 2, 589831, 196608, 2, 8, 196608, 2, 65544, 65536, 1, 131080, 65536, 1, 196616, 65536, 1, 262152, 65536, 1, 327688, 65536, 1, 393224, 65536, 1, 458760, 65536, 1, 524296, 65536, 1, 589832, 196608, 2, 9, 196608, 2, 65545, 65536, 1, 131081, 65536, 1, 196617, 65536, 1, 262153, 65536, 1, 327689, 65536, 1, 393225, 65536, 1, 458761, 65536, 1, 524297, 65536, 1, 589833, 196608, 2, 10, 196608, 2, 65546, 65536, 1, 131082, 65536, 1, 196618, 65536, 1, 262154, 65536, 1, 327690, 65536, 1, 393226, 65536, 1, 458762, 65536, 1, 524298, 65536, 1, 589834, 196608, 2, 11, 196608, 2, 65547, 65536, 1, 131083, 65536, 1, 196619, 65536, 1, 262155, 65536, 1, 327691, 65536, 1, 393227, 65536, 1, 458763, 65536, 1, 524299, 196608, 2, 12, 196608, 2, 65548, 65536, 1, 131084, 65536, 1, 196620, 65536, 1, 262156, 65536, 1, 327692, 65536, 1, 393228, 65536, 1, 458764, 196608, 2, 524300, 196608, 2, 13, 196608, 2, 65549, 196608, 2, 131085, 196608, 2, 196621, 65536, 1, 262157, 65536, 1, 327693, 65536, 1, 393229, 196608, 2, 458765, 196608, 2, 131086, 196608, 2, 196622, 196608, 2, 262158, 196608, 2, 327694, 196608, 2, 393230, 196608, 2)

[node name="FireSpell" parent="." instance=ExtResource("3_6pgig")]
position = Vector2(67, 25)

[node name="Crate" parent="." instance=ExtResource("4_qeshn")]
position = Vector2(92, 28)
collision_layer = 100
collision_mask = 65

[node name="Health" parent="Crate" index="1"]
max_health = 12

[node name="Sprite2D" parent="Crate" index="3"]
material = SubResource("ShaderMaterial_ocv7n")

[node name="Spawner" type="Node2D" parent="Crate"]
position = Vector2(7, 7)
rotation = 1.5708
script = ExtResource("7_ofaj6")
scene = ExtResource("8_xv0h7")
specified_parent = NodePath("../..")

[node name="Timer" type="Timer" parent="Crate/Spawner"]
wait_time = 2.0
autostart = true

[node name="Crate2" parent="." instance=ExtResource("4_qeshn")]
position = Vector2(111, 29)

[node name="Crate3" parent="." instance=ExtResource("4_qeshn")]
position = Vector2(142, 29)

[node name="Crate4" parent="." instance=ExtResource("4_qeshn")]
position = Vector2(177, 30)

[node name="DirectionalLight2D" type="DirectionalLight2D" parent="."]
energy = 0.0

[node name="PointLight2D" type="PointLight2D" parent="."]
visible = false
position = Vector2(107, 48)
texture = SubResource("GradientTexture2D_qnxt6")

[node name="Sprite2D" type="Sprite2D" parent="."]
z_index = -1
material = SubResource("ShaderMaterial_06tm4")
texture = SubResource("ViewportTexture_2v0d8")
centered = false

[node name="BloodViewport" type="SubViewport" parent="Sprite2D"]
own_world_3d = true
transparent_bg = true
handle_input_locally = false
size = Vector2i(288, 162)
render_target_clear_mode = 1

[node name="BloodEffect" parent="Sprite2D/BloodViewport" instance=ExtResource("5_8p0uu")]
position = Vector2(100, 50)

[node name="GPUParticles2D" parent="Sprite2D/BloodViewport/BloodEffect" index="0"]
process_material = SubResource("ParticleProcessMaterial_t0pgi")

[connection signal="timeout" from="Crate/Spawner/Timer" to="Crate/Spawner" method="spawn"]

[editable path="Crate"]
[editable path="Sprite2D/BloodViewport/BloodEffect"]
